name: CI/CD RETTA App

on:
  push:
    branches:
      - main  # ou "master", se for o nome principal do seu repositÃ³rio

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ”„ Clonar repositÃ³rio
        uses: actions/checkout@v3

      - name: ğŸ³ Subir containers com Docker Compose
        run: |
          docker compose -f docker-compose.yml up -d --build

      - name: â±ï¸ Aguardar containers subirem
        run: sleep 10  # opcional, mas ajuda a evitar erro de "container not ready"

      - name: ğŸ“¦ Instalar dependÃªncias do Laravel
        run: |
          docker exec jobs_RETTA composer install
          docker exec jobs_RETTA php artisan key:generate
          docker exec jobs_RETTA php artisan migrate --force

      - name: âœ… Verificar serviÃ§os
        run: docker ps

      - name: ğŸ§ª Testar aplicaÃ§Ã£o Laravel
        run: docker exec jobs_RETTA php artisan test

      - name: ğŸš€ Finalizar deploy
        run: echo "âœ… Deploy concluÃ­do com sucesso!"
